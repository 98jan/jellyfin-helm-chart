{
  "extends": ["config:base"],
  "packageRules": [
    {
      "description": "Update Docker image based on renovate comment",
      "matchDatasources": ["docker"],
      "matchPackagePatterns": [".*"],
      "automerge": true,
      "automergeType": "branch",
      "commitMessage": "Update Docker image for {{depName}}",
      "labels": ["docker", "update"],
      "allowPostUpgradeCommandTemplating": true,
      "allowedPostUpgradeCommands": ["^.*"]
    },
    {
      "matchManagers": ["helm-requirements", "helm-values", "regex"],
      "postUpgradeTasks": {
        "commands": [
          "version=$(grep '^version:' {{{parentDir}}}/charts/jellyfin/Chart.yaml | awk '{print $2}')",
          "major=$(echo $version | cut -d. -f1)",
          "minor=$(echo $version | cut -d. -f2)",
          "patch=$(echo $version | cut -d. -f3)",
          "minor=$(expr $minor + 1)",
          "echo XXX",
          "echo $version",
          "sed -i \"s/^version:.*/version: ${major}.${minor}.${patch}/g\" {{{parentDir}}}/charts/jellyfin/Chart.yaml",
          "sed -i \"s/^appVersion:.*/appVersion: ${major}.${minor}.${patch}/g\" {{{parentDir}}}/charts/jellyfin/Chart.yaml"
        ],
        "fileFilters": ["**/Chart.yaml"],
        "executionMode": "branch",
        "allowPostUpgradeCommandTemplating": true,
        "allowedPostUpgradeCommands": ["^.*"]
      }
    }
  ],
  "regexManagers": [
    {
      "fileMatch": ["^.*\\.yaml$", "^.*\\.yml$"],
      "matchStrings": [
        "# renovate: datasource=docker depName=(?<depName>\\S+)\\s+(?<currentValue>.+)"
      ],
      "datasourceTemplate": "docker",
      "depNameTemplate": "{{depName}}",
      "versioningTemplate": "docker"
    }
  ],
  "includeForks": true
}